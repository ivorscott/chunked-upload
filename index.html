<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <meta http-equiv="X-UA-Compatible" content="ie=edge" />
 <script src="https://cdn.jsdelivr.net/npm/tus-js-client@latest/dist/tus.min.js"></script>
 <title>Chunked upload demo</title>
</head>
<body>
<form id="form" enctype="multipart/form-data">
 <input class="input file-input" type="file" name="upload" multiple />
 <button class="button" type="submit">Submit</button>
</form>

<script>
 const form = document.getElementById("form");
 form.onsubmit = handleUpload;

 function handleUpload(event) {
  event.preventDefault();

   // Get the selected file from the input element
   var file = event.target.elements.upload.files[0]

   // Create a new tus upload
   var upload = new tus.Upload(file, {
    chunkSize: 1024 * 1024, // 1MiB
    // Endpoint is the upload creation URL from your tus server
    endpoint: "http://localhost:1080/files/",
    // Retry delays will enable tus-js-client to automatically retry on errors
    retryDelays: [0, 3000, 5000, 10000, 20000],
    // Attach additional meta data about the file for the server
    metadata: {
     filename: file.name,
     filetype: file.type
    },
    // Callback for errors which cannot be fixed using retries
    onError: function(error) {
     console.log("Failed because: " + error)
    },
    // Callback for reporting upload progress
    onProgress: function(bytesUploaded, bytesTotal) {
     var percentage = (bytesUploaded / bytesTotal * 100).toFixed(2)
     console.log(bytesUploaded, bytesTotal, percentage + "%")
    },
    // Callback for once the upload is completed
    onSuccess: function() {
     console.log("Download %s from %s", upload.file.name, upload.url)
    }
   })

   // Check if there are any previous uploads to continue.
   upload.findPreviousUploads().then(function (previousUploads) {
    // Found previous uploads so we select the first one.
    if (previousUploads.length) {
     upload.resumeFromPreviousUpload(previousUploads[0])
    }

    // Start the upload
    upload.start()
   })
 }
</script>
</body>
</html>
